<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link href="css/bulma.css" rel="stylesheet"/>
    <!-- <link href="css/style.css" rel="stylesheet"/> -->
    <link href="css/bulma-badge.min.css" rel="stylesheet"/>
    <script src="https://db.gcs.world/src/shortcut.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/live.js"></script>
    <script src="js/login.js"></script>
    <script src="js/http-req.js"></script>
    <link href="css/style.css" rel="stylesheet"/>
    <script>
        cekLogin()
    </script>
    <title>Jadwal</title>
</head>
<body>
    <nav class="navbar has-shadow" role="navigation" aria-label="main navigation">
        <div class="container">
            <div class="navbar-brand">
                <div>
                    <img src="http://nlsschool.com/assets/logo-withLabel.png" width="100" height="100">
                </div>

                <a role="button" class="navbar-burger" id="menu-toggle" data-target="navMenu" aria-label="menu" aria-expanded="false">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div class="navbar-menu" id="navMenu">
                <div class="navbar-end">
                    <div class="is-hidden-desktop">
                        <a class="navbar-item" href="administration.html">Administrasi</a>
                        <a class="navbar-item" href="discussion.html">Discussion</a>
                        <a class="navbar-item" href="classforum.html">Class Forum</a>
                        <a class="navbar-item is-active" href="detail_jadwal.html">Schedule</a>
                        <a class="navbar-item" href="absensi.html">Absensi</a>
                        <a class="navbar-item" href="raporOnline.html">Report</a>
                        <a class="navbar-item" href="absensi.html">Attendance</a>
                        <a class="navbar-item" href="faqbaru.html">FAQ</a>
                    </div>

                    <div class="navbar-item has-dropdown" id="accountMenu">
                        <a class="navbar-link" id="name"></a>

                        <div class="navbar-dropdown">
                            <a class="navbar-item" onclick="logout()">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- column -->
        <section class="section">

            <div class="columns">
                <div class="column is-2 is-hidden-touch">
                    <aside class="menu">
                        <p class="menu-label">
                            General
                        </p>
                        <ul class="menu-list">
                            <ul class="menu-list">
                                <li><a href="administration.html">Adminstration</a></li>
                                <li><a href="discussion.html">Discussion</a></li>
                                <li><a href="classforum.html" >Class Forum</a></li>
                                <li><a href="detail_jadwal.html" class="is-active">Schedule</a></li>
                                <li><a href="raporOnline.html">Report</a></li>
                                <li><a href="faqbaru.html">FAQ</a></li>
                            </ul>
                        </ul>
                        <p class="menu-label">
                            Teacher Discussion
                        </p>
                        <ul class="menu-list">
                            <li><a>Fisika</a></li>
                            <li><a>Biologi</a></li>
                            <li><a>Kimia</a></li>
                            <li><a>Matematika</a></li>
                        </ul>
                    </aside>
                </div>

                <div class="column">
                    <div class="control">
                        <label for="#pilih-anak">Student</label>
                        <div class="select is-primary is-fullwidth">
                            <div class="list-anak">
                                <select name="anak" id="pilih-anak" class="list">
                                    <option data-kelas="Class1A" data-tingkat="smp">Alex</option>
                                    <option data-kelas="Class1B" data-tingkat="sma">Bella</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="control">
                        <label for="#pilih-hari">Day</label>
                        <div class="select is-primary is-fullwidth">
                            <div class="list-hari">
                                <select name="hari" id="pilih-hari" class="list">
                                    <option value="">---</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <br>

                    <div class="schedule-container">
                        <table class="table is-fullwidth is-hoverable">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Subject</th>
                                    <th>Detail</th>
                                    <th>Assignment</th>
                                    <th>Attendance</th>
                                </tr>
                            </thead>
                            <tbody class="schedule">

                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="modal" id="modal-assignment">
        <div class="modal-background"></div>
        <div class="modal-card">
            <div class="modal-card-head">
                <p class="modal-card-title">Assignment 1</p>
            </div>
            <button class="modal-close is-large" aria-label="close"></button>
        </div>
    </div>

    <script>
    $('#menu-toggle').on('click', function() {
        $(this).toggleClass('is-active')
        $('#navMenu').slideToggle('medium', function() {
            $(this).toggleClass('is-active')
        })
    })
    </script>

    <script>
        $(function() {
            const weekday = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu']
            var date = new Date()
            var day = weekday[date.getDay()-1]
            var schedule = $(".schedule")
            var selected_day = $('#pilih-hari')
            var kelas = $("#pilih-anak").find(':selected').data('kelas')
            var tingkat = $('#pilih-anak').find(':selected').data('tingkat')

            function startOfWeek(date) {
                var diff = date.getDate() - date.getDay() + (date.getDay() === 0 ? -6 : 1)
                return new Date(date.setDate(diff))
            }

            function getDateByDay() {
                let curr = new Date()
                let next = startOfWeek(curr)
                let theday = []
                var i=0
                while(i<7) {
                    theday[i] = next.toDateString()
                    next.setDate(next.getDate()+1)
                    i++
                }

                return theday
            }

            var week = getDateByDay()

            for (const i in weekday) {
                $('#pilih-hari').append("<option value=" + weekday[i] + ">" + week[i] + "</option>")
            }

            setSchedule(day)
            selected_day.val(day)

            // schedule data per anak
            $("#pilih-anak").on("change", () => {
                tingkat = $('#pilih-anak').find(':selected').data('tingkat')
                schedule.empty()
                selected_day.val(day)
                setSchedule(day)
            })

            // fungsi untuk atur jadwal berdasarkan hari
            function setSchedule(day) {
                schedule.empty()
                let n = 1

                // cari jadwal berdasarkan kelas
                getSchedule(kelas, function(anakSchedule) {
                    for (const i in anakSchedule) {
                        // cek tingkat sd/smp/sma
                        if (tingkat === anakSchedule[i]._room) {
                            // cek hari
                            if (day === anakSchedule[i].day) {
                                $(".schedule").append(
                                '<tr>' +
                                    '<td>' + anakSchedule[i].number + '</td>' +
                                    '<td>' + anakSchedule[i].subject + '</td>' +
                                    '<td>'+
                                        '<div class="container-fluid"> ' +
                                            '<p>Bab 1</p>' +
                                            '<p>Pengenalan</p>' +
                                        '</div>' +
                                    '</td>' +
                                    '<td><a class="button btn-assignment">Open</a></td>' +
                                    '<td>Yes</td>' +
                                '</tr>'
                                )
                                n++
                            }
                        }
                    }

                    $('.btn-assignment').on('click', function() {
                        $('#modal-assignment').addClass('is-active')
                        $('.modal-close').on('click', function() {
                            $('#modal-assignment').removeClass('is-active')
                        })
                    })
                })
            }


            selected_day.change(() => {
                console.log(selected_day.val())
                setSchedule(selected_day.val())
            })

            $('#menu-toggle').on('click', function() {
                $(this).toggleClass('is-active')
                $($(this).data('target')).slideToggle('medium', function() {
                    $(this).toggleClass('is-active')
                })
            })
        })
    </script>
</body>
</html>
