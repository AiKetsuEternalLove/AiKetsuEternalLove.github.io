<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <link href="../../css/bulma.css" rel="stylesheet"/>
    <!-- <link href="css/style.css" rel="stylesheet"/> -->
    <link href="../../css/bulma-badge.min.css" rel="stylesheet"/>
    <script src="https://db.gcs.world/src/shortcut.js"></script>
    <script src="../../js/jquery.js"></script>
    <script src="../../js/live.js"></script>
    <script src="../../js/login.js"></script>
    <!-- <link href="css/style.css" rel="stylesheet"/> -->
    <title>Rapor bulanan</title>
</head>
<body>
    
    <nav class="navbar has-shadow" role="navigation" aria-label="main navigation">
        <div class="container">
            <div class="navbar-brand">
                <div>
                    <img src="http://nlsschool.com/assets/logo-withLabel.png" width="200" height="100">
                </div>
                
                <a role="button" class="navbar-burger" id="menu-toggle" data-target="navMenu" aria-label="menu" aria-expanded="false">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>
            
            <div class="navbar-menu" id="navMenu">
                <div class="navbar-end">
                    <div class="is-hidden-desktop">
                        <a class="navbar-item" href="administration.html">Administrasi</a>
                        <a class="navbar-item" href="discussion.html">Discussion</a>
                        <a class="navbar-item is-active" href="classforum.html">Class Forum</a>
                        <a class="navbar-item" href="jadwal-sd.html">Schedule</a>
                        <a class="navbar-item" href="">Report</a>
                        <a class="navbar-item" href="">FAQ</a>
                    </div>
                    
                    <div class="navbar-item has-dropdown" id="accountMenu">
                        <a class="navbar-link" id="name"></a>
                        
                        <div class="navbar-dropdown">
                            <a class="navbar-item" onclick="logout()">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container-fluid">
        <!-- column -->
        <section class="section">
            
            <div class="columns">
                <div class="column is-3 is-hidden-touch">
                    <aside class="menu">
                        <p class="menu-label">
                            General
                        </p>
                        <ul class="menu-list">
                            <ul class="menu-list">
                                <li><a class="is-active" href="#">Class Forum</a></li>
                                <li><a href="jadwal-sd.html">Schedule</a></li>
                                <li><a>Report</a></li>
                                <li><a href="absensi-sd.html">Attendance</a></li>
                            </ul>
                        </ul>
                    </aside>
                </div>
                
                <div class="column">
                    <div class="columns is-mobile">
                        <div class="column">
                            <a href="newDiscussion.html" class="button is-primary">New discussion</a>
                        </div>
                        <div class="column">
                            <button class="button is-primary badge" data-badge="8">
                                <i class="fa fa-bell" aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="column is-8">
                            <div class="field has-addons">
                                <div class="control is-expanded">
                                    <input type="text" class="input is-primary" placeholder="Search post...">
                                </div>
                                <div class="control">
                                    <a class="button is-primary">
                                        <i class="fas fa-search"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <nav class="panel is-mobile">
                        <div class="level">
                            <div class="level-left">
                                <p class="panel-tabs">
                                    <a class="is-active">All</a>
                                    <a>Published</a>
                                    <a>Draft</a>
                                    <a>Deleted</a>
                                </p>
                            </div>
                        </div>
                    </nav>
                    
                    <p id="list-discussion" class="notification"></p>
                    
                    <div class="list-discussion-container">
                        
                    </div>
                    <!-- PAGINATION -->
                    <div class="block">
                        <nav class="pagination">
                            <a href="" class="pagination-previous" disabled>Previous</a>
                            <a href="" class="pagination-next" disabled>Next page</a>
                            <ul class="pagination-list">
                            </ul>
                        </nav>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
</body>
</html>

<script>
    $(document).ready(() => {
        
        $('#menu-toggle').on('click', function() {
            $(this).toggleClass('is-active')
            $('#navMenu').slideToggle('medium', function() {
                $(this).toggleClass('is-active')
            })
        })
        
        //get all discussion
        getAllDiscussion(true);
        
        function getAllDiscussion(firstReload) {
            shortcut.get({ _room: 'test', _type: 'discussion' }).then(function(data) {
                populateFirstPageData(data);
                addPaginationLink(data);
                addPagination(data);
                console.log(data);
            });
        }
        
        function getDiffTime(timeCreated) {
            var time = new Date(timeCreated)
            var currentTime = new Date()
            
            // get total seconds between the times
            var delta = Math.abs(currentTime - time) / 1000;
            console.log(delta);
            
            
            // calculate (and subtract) whole days
            var days = Math.floor(delta / 86400);
            delta -= days * 86400;
            console.log(days);
            
            
            // calculate (and subtract) whole hours
            var hours = Math.floor(delta / 3600) % 24;
            delta -= hours * 3600;
            console.log(hours);
            
            
            // calculate (and subtract) whole minutes
            var minutes = Math.floor(delta / 60) % 60;
            delta -= minutes * 60;
            console.log(minutes);
            
            
            // what's left is seconds
            var seconds = delta % 60;  // in theory the modulus is not required
            seconds = parseInt(seconds);
            console.log(seconds);
            
            
            var diffTime = new Array()
            diffTime['d'] = days;
            diffTime['h'] = hours;
            diffTime['m'] = minutes;
            diffTime['s'] = seconds;
            return diffTime;
        }
        
        function populateFirstPageData(x) {
            $("#list-discussion").html(" ");
            console.log(x);
            
            
            for (var i = 0; i < 3; i++) {
                var diffTime = getDiffTime(x[i].time)
                
                $("#list-discussion").append("<article class=\"media\">                    <div class=\"media-content\">                        <a href=\"detailDiscussion.html\">                            <div class=\"content\">                               <p>                                    <strong>"+x[i].name+x[i]._id+"</strong> <small>"+x[i].mapel+"</small> <small>"+diffTime['d']+" m</small> <small>"+diffTime['h']+" m</small> <small>"+diffTime['m']+" m</small> <small>"+diffTime['s']+" s ago</small>                                    <br>  "+x[i].msg+"                                  </p>                            </div></a>                    </div>                    <div class=\"media-right\">                        <button id=\"delete-discussion-"+x[i]._id+"\" class=\"delete\"></button>                    </div>                </article>");
                $("#delete-discussion-"+x[i]._id).click(function() {
                    //alert($(this).attr('id').split('--', 2)[1]);
                    shortcut.del({_room: 'test', _type: 'discussion', _id: '-'+$(this).attr('id').split('--', 2)[1] })
                    .then(function(data) {
                        getAllDiscussion(false);
                        console.log(data);
                    });
                });
            }
        }
        
        //shortcut.del({ _room: 'test', _type: 'discussion' });
        function getNextPage() {
            shortcut.get({ _room: 'test', _type: 'discussion' }).then(function(data) {
                //populateFirstPageData(data);
                getAllDiscussion(false);
                console.log();
            });
        }
        
        function addPagination(x) {
            //limit per halaman = 3 discussion
            var pagination = Math.ceil(x.length / 3);
            $(".pagination-list").html(" ");
            for (var i = 0; i < pagination; i++) {
                if (i ==0 )
                $(".pagination-list").append(" <li> <a id=\"pagination-"+i+"\" class=\"pagination-link is-current\">"+(i+1)+"</a></li>");
                else
                $(".pagination-list").append(" <li> <a id=\"pagination-"+i+"\" class=\"pagination-link\">"+(i+1)+"</a></li>");
            }
            
            addPaginationLink(x);
        }
        
        function addPaginationLink(x) {
            $(".pagination-link").click(function() {
                //alert($(this).attr('id'));
                //alert($(this).attr('id').slice(-1));
                var page = ($(this).attr('id').slice(-1));
                $(".pagination-link").attr('class', 'pagination-link');
                $(this).attr('class', 'pagination-link is-current');
                
                clearListDiscussion();
                for (var i = page * 3; i < page * 3 + 3; i++) {
                    var diffTime = getDiffTime(x[i].time)
                    $("#list-discussion").append("<article class=\"media\">                    <div class=\"media-content\">                        <a href=\"detailDiscussion.html\">                            <div class=\"content\">                               <p>                                    <strong>"+x[i].name+x[i]._id+"</strong> <small>"+x[i].mapel+"</small> <small>"+diffTime['d']+" days</small> <small>"+diffTime['h']+" hours</small> <small>"+diffTime['m']+" m</small> <small>"+diffTime['s']+" s ago</small>                                    <br>  "+x[i].msg+"                                  </p>                            </div></a>                    </div>                    <div class=\"media-right\">                        <button id=\"delete-discussion-"+x[i]._id+"\" class=\"delete\"></button>                    </div>                </article>");
                    $("#delete-discussion-"+x[i]._id).click(function() {
                        //alert($(this).attr('id').split('--', 2)[1]);
                        //shortcut.del({_room: 'test', _type: 'discussion', _id: '-'+$(this).attr('id').split('--', 2)[1] }).then(getAllDiscussion(false)).catch(console.log);
                        shortcut.del({_room: 'test', _type: 'discussion', _id: '-'+$(this).attr('id').split('--', 2)[1] })
                        .then(function(data) {
                            getAllDiscussion(false);
                            console.log(data);
                        });
                        
                    });
                }
            });
        }
        
        function clearListDiscussion() {
            
            $("#list-discussion").html(" ");
        }
        
        function clearListPagination() {
            
        }
        
    });
    
</script>
